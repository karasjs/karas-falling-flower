{"version":3,"file":"index.es.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\nimport { version } from '../package.json';\n\nconst {\n  enums: {\n    STYLE_KEY: {\n      DISPLAY,\n      VISIBILITY,\n      OPACITY,\n    },\n    NODE_KEY: {\n      NODE_REFRESH_LV,\n    },\n  },\n  refresh: {\n    level: {\n      REPAINT,\n    },\n    Cache,\n  },\n  util: {\n    isNil,\n    isFunction,\n  },\n  math: {\n    geom: {\n      d2r,\n    },\n    matrix: {\n      identity,\n      multiply,\n    },\n  },\n  mode: {\n    CANVAS,\n    WEBGL,\n  },\n} = karas;\n\nlet uuid = 0;\n\nclass FallingFlower extends karas.Component {\n  constructor(props) {\n    super(props);\n    this.count = 0;\n    this.time = 0;\n    this.playbackRate = props.playbackRate || 1;\n    this.interval = props.interval || 300;\n    this.intervalNum = props.intervalNum || 1;\n    this.num = props.num || 0;\n  }\n\n  shouldComponentUpdate() {\n    return false;\n  }\n\n  componentWillUnmount() {\n    Object.keys(this.hashImg || {}).forEach(k => {\n      this.hashImg[k].release();\n    });\n    this.hashCache = {};\n    this.hashMatrix = {};\n    this.hashImg = {};\n    this.hashOpacity = {};\n    this.hashTfo = {};\n  }\n\n  componentDidMount() {\n    let { props } = this;\n    let { list = [], initNum = 0, delay = 0, autoPlay } = props;\n    let dataList = [];\n    let i = 0, length = list.length;\n    let lastTime = 0, count = 0;\n    let fake = this.ref.fake;\n    let root = this.root;\n    let hashCache = this.hashCache = {};\n    let hashMatrix = this.hashMatrix = {};\n    let hashImg = this.hashImg = {};\n    let hashOpacity = this.hashOpacity = {};\n    let hashTfo = this.hashTfo = {};\n    let currentTime = 0, maxTime = 0;\n    let hasStart;\n    let cb = this.cb = diff => {\n      diff *= this.playbackRate;\n      currentTime += diff;\n      if(delay > 0) {\n        delay -= diff;\n      }\n      if(delay <= 0) {\n        diff += delay;\n        this.time += diff;\n        delay = 0;\n      }\n      // 如果有初始粒子\n      if(initNum > 0) {\n        lastTime = this.time;\n        while(initNum-- > 0) {\n          i++;\n          i %= length;\n          count++;\n          let o = this.genItem(list[i]);\n          maxTime = Math.max(maxTime, currentTime + o.duration);\n          dataList.push(o);\n        }\n      }\n      // 已有的每个粒子时间增加计算位置，结束的则消失\n      for(let j = dataList.length - 1; j >= 0; j--) {\n        let item = dataList[j];\n        item.time += diff;\n        if(item.time >= item.duration) {\n          dataList.splice(j, 1);\n          delete hashCache[item.id];\n          delete hashMatrix[item.id];\n        }\n        else if(item.source) {\n          let { x, y, width, height, distance, direction, iterations = 1, time, duration } = item;\n          let percent = time / duration;\n          let dy = distance * percent;\n          let per = duration / iterations;\n          let count = Math.floor(time / per);\n          item.nowPercent = (time % per) / per;\n          item.nowDirection = (count % 2 === 0) ? direction : !direction;\n          item.nowX = x - width * 0.5;\n          item.nowY = y + dy - height * 0.5;\n          item.loaded = true;\n          hasStart = true;\n        }\n      }\n      // 开始后每次都刷新，即便数据已空，要变成空白初始状态\n      if(hasStart) {\n        fake.clearCache();\n        let p = fake.domParent;\n        while (p) {\n          p.clearCache(true);\n          p = p.domParent;\n        }\n        root.addForceRefreshTask(() => {\n          this.emit('frame');\n        });\n      }\n      if(count >= this.num) {\n        if(currentTime >= maxTime) {\n          fake.removeFrameAnimate(cb);\n        }\n        return;\n      }\n      // 每隔interval开始生成这一阶段的粒子数据\n      if(this.time >= lastTime + this.interval) {\n        lastTime = this.time;\n        for(let j = 0; j < this.intervalNum; j++) {\n          i++;\n          i %= length;\n          count++;\n          let o = this.genItem(list[i]);\n          maxTime = Math.max(maxTime, currentTime + o.duration);\n          dataList.push(o);\n          if(count >= this.num) {\n            break;\n          }\n        }\n      }\n    };\n    if(autoPlay !== false) {\n      fake.frameAnimate(cb);\n    }\n    let __config = fake.__config;\n    __config[NODE_REFRESH_LV] |= REPAINT;\n    let shadowRoot = this.shadowRoot;\n    let texCache = this.root.texCache;\n    fake.render = (renderMode, lv, ctx, cache, dx = 0, dy = 0) => {\n      let time = currentTime - delay;\n      if(time < 0) {\n        return;\n      }\n      __config[NODE_REFRESH_LV] |= REPAINT;\n      let computedStyle = shadowRoot.computedStyle;\n      if(computedStyle[DISPLAY] === 'none'\n        || computedStyle[VISIBILITY] === 'hidden'\n        || computedStyle[OPACITY] <= 0) {\n        return;\n      }\n      let { sx, sy } = fake;\n      let globalAlpha;\n      if(renderMode === CANVAS) {\n        globalAlpha = ctx.globalAlpha;\n      }\n      else if(renderMode === WEBGL) {\n        globalAlpha = computedStyle[OPACITY];\n      }\n      dataList.forEach(item => {\n        if(item.loaded) {\n          let opacity = globalAlpha;\n          opacity *= item.opacity;\n          // 计算位置\n          let x = item.nowX + sx + dx;\n          let y = item.nowY + sy + dy;\n          let m = identity();\n          let tfo = [x, y + item.origin];\n          if(renderMode === CANVAS) {\n            m = multiply([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tfo[0], tfo[1], 0, 1], m);\n          }\n          let r;\n          // 左右摇摆为一个时期，前半在一侧后半在另一侧\n          if(item.nowPercent >= 0.5) {\n            r = d2r(item.deg * (item.nowPercent - 0.5) * (item.nowDirection ? -1 : 1));\n          }\n          else {\n            r = d2r(item.deg * (0.5 - item.nowPercent) * (item.nowDirection ? 1 : -1));\n          }\n          let t = identity();\n          let sin = Math.sin(r);\n          let cos = Math.cos(r);\n          t[0] = t[5] = cos;\n          t[1] = sin;\n          t[4] = -sin;\n          m = multiply([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tfo[0], tfo[1], 0, 1], m);\n          m = multiply(m, t);\n          if(renderMode === WEBGL) {\n            let cache = hashCache[item.id];\n            if(!cache) {\n              let url = item.url;\n              if(!hashImg[url]) {\n                cache = hashCache[item.id] = Cache.getInstance(\n                  [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1],\n                  x, y\n                );\n                cache.ctx.drawImage(item.source, x + cache.dx, y + cache.dy)\n                hashImg[url] = cache;\n              }\n              else {\n                let c = hashImg[url];\n                cache = hashCache[item.id] = new karas.refresh.Cache(\n                  c.width, c.height,\n                  [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1],\n                  c.page, c.pos, x, y\n                );\n              }\n            }\n            else {\n              cache.__bbox = [x - 1, y - 1, x + item.sourceWidth + 1, y + item.sourceHeight + 1];\n              cache.__sx = x;\n              cache.__sy = y;\n            }\n            if(item.width !== item.sourceWidth && item.height !== item.sourceHeight) {\n              let t2 = identity();\n              t2[0] = item.width / item.sourceWidth;\n              t2[5] = item.height / item.sourceHeight;\n              m = multiply(m, t2);\n            }\n            // m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -tfo[0], -tfo[1], 0, 1]);\n            hashMatrix[item.id] = m;\n            hashOpacity[item.id] = opacity;\n          }\n          else if(renderMode === CANVAS) {\n            ctx.globalAlpha = opacity;\n            // canvas处理方式不一样，render的dx和dy包含了total的偏移计算考虑，可以无感知\n            m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -tfo[0], -tfo[1], 0, 1]);\n            // 父级的m\n            let pm = this.matrixEvent;\n            if(pm) {\n              m = multiply(pm, m);\n            }\n            ctx.setTransform(m[0], m[1], m[4], m[5], m[12], m[13]);\n            ctx.drawImage(item.source, x, y, item.width, item.height);\n          }\n        }\n      });\n      if(renderMode === CANVAS) {\n        ctx.globalAlpha = globalAlpha;\n      }\n    };\n    fake.hookGlRender = function(gl, opacity, matrix, cx, cy, dx, dy, revertY) {\n      let computedStyle = shadowRoot.computedStyle;\n      if(computedStyle[DISPLAY] === 'none'\n        || computedStyle[VISIBILITY] === 'hidden'\n        || computedStyle[OPACITY] <= 0) {\n        return;\n      }\n      dataList.forEach(item => {\n        if(item.loaded) {\n          let id = item.id;\n          let tfo = hashTfo[id].slice(0);\n          tfo[0] += dx;\n          tfo[1] += dy;\n          let m = hashMatrix[id];\n          m = multiply([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tfo[0], tfo[1], 0, 1], m);\n          m = multiply(m, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -tfo[0], -tfo[1], 0, 1]);\n          // 父级的m\n          if(matrix) {\n            m = multiply(matrix, m);\n          }\n          texCache.addTexAndDrawWhenLimit(gl, hashCache[id], hashOpacity[id], m, cx, cy, dx, dy, revertY);\n        }\n      });\n    };\n  }\n\n  genItem(item) {\n    let { width, height, props } = this;\n    let o = {\n      id: uuid++,\n      time: 0,\n      url: item.url,\n    };\n    if(Array.isArray(item.x)) {\n      o.x = (item.x[0] + Math.random() * (item.x[1] - item.x[0])) * width;\n    }\n    else {\n      o.x = item.x * width;\n    }\n    if(Array.isArray(item.y)) {\n      o.y = (item.y[0] + Math.random() * (item.y[1] - item.y[0])) * height;\n    }\n    else {\n      o.y = item.y * height;\n    }\n    if(Array.isArray(item.duration)) {\n      o.duration = (item.duration[0] + Math.random() * (item.duration[1] - item.duration[0]));\n    }\n    else {\n      o.duration = item.duration;\n    }\n    if(Array.isArray(item.width)) {\n      o.width = item.width[0] + Math.random() * (item.width[1] - item.width[0]);\n    }\n    else if(!isNil(item.width)) {\n      o.width = item.width;\n    }\n    if(Array.isArray(item.height)) {\n      o.height = item.height[0] + Math.random() * (item.height[1] - item.height[0]);\n    }\n    else if(!isNil(item.height)) {\n      o.height = item.height;\n    }\n    let distance = 0;\n    if(Array.isArray(item.distance)) {\n      distance = (item.distance[0] + Math.random() * (item.distance[1] - item.distance[0])) * height;\n    }\n    else if(distance) {\n      distance = item.distance * height;\n    }\n    o.distance = distance;\n    if(Array.isArray(item.deg)) {\n      o.deg = item.deg[0] + Math.random() * (item.deg[1] - item.deg[0]);\n    }\n    else if(!isNil(item.deg)) {\n      o.deg = item.deg;\n    }\n    else {\n      o.deg = 0;\n    }\n    if(Array.isArray(item.origin)) {\n      o.origin = item.origin[0] + Math.random() * (item.origin[1] - item.origin[0]);\n    }\n    else if(!isNil(item.origin)) {\n      o.origin = item.origin;\n    }\n    else {\n      o.origin = 0;\n    }\n    // 随机左右\n    o.direction = Math.random() > 0.5;\n    if(Array.isArray(item.iterations)) {\n      o.iterations = item.iterations[0] + Math.round(Math.random() * (item.iterations[1] - item.iterations[0]));\n    }\n    else if(!isNil(item.iterations)) {\n      o.iterations = item.iterations;\n    }\n    if(item.url) {\n      karas.inject.measureImg(item.url, function(res) {\n        if(res.success) {\n          o.source = res.source;\n          o.sourceWidth = res.width;\n          o.sourceHeight = res.height;\n          if(!(isNil(o.width) && isNil(o.height))) {\n            if(isNil(o.width)) {\n              o.width = res.width / res.height * o.height;\n            }\n            else if(isNil(o.height)) {\n              o.height = o.width * res.height / res.width;\n            }\n          }\n          else {\n            o.width = res.width;\n            o.height = res.height;\n          }\n          if(o.height) {\n            o.origin *= o.height;\n          }\n        }\n      });\n    }\n    if(props.hookData && isFunction(props.hookData)) {\n      o = props.hookData(o);\n    }\n    return o;\n  }\n\n  pause() {\n    this.ref.fake.removeFrameAnimate(this.cb);\n  }\n\n  resume() {\n    this.ref.fake.frameAnimate(this.cb);\n  }\n\n  play() {\n    this.count = 0;\n    this.time = 0;\n    this.ref.fake.removeFrameAnimate(this.cb);\n    this.ref.fake.frameAnimate(this.cb);\n  }\n\n  get playbackRate() {\n    return this.__playbackRate;\n  }\n\n  set playbackRate(v) {\n    this.__playbackRate = parseFloat(v) || 1;\n  }\n\n  get interval() {\n    return this.__interval;\n  }\n\n  get intervalNum() {\n    return this.__intervalNum;\n  }\n\n  set intervalNum(v) {\n    this.__intervalNum = parseInt(v) || 1;\n  }\n\n  set interval(v) {\n    this.__interval = parseInt(v) || 300;\n  }\n\n  get num() {\n    return this.__num;\n  }\n\n  set num(v) {\n    if(v === Infinity || /infinity/i.test(v)) {\n      this.__num = Infinity;\n    }\n    else {\n      this.__num = parseInt(v) || 0;\n    }\n  }\n\n  render() {\n    return <div>\n      <$polyline ref=\"fake\" style={{width:0,height:0,visibility:'hidden'}}/>\n    </div>;\n  }\n}\n\nFallingFlower.version = version;\n\nexport default FallingFlower;\n"],"names":["karas","enums","STYLE_KEY","DISPLAY","VISIBILITY","OPACITY","NODE_REFRESH_LV","NODE_KEY","refresh","REPAINT","level","Cache","util","isNil","isFunction","math","d2r","geom","matrix","identity","multiply","mode","CANVAS","WEBGL","uuid","FallingFlower","props","count","time","playbackRate","interval","intervalNum","num","Object","keys","hashImg","forEach","k","release","hashCache","hashMatrix","hashOpacity","hashTfo","list","initNum","delay","autoPlay","dataList","i","length","lastTime","fake","ref","root","currentTime","maxTime","hasStart","cb","diff","o","genItem","Math","max","duration","push","j","item","splice","id","source","x","y","width","height","distance","direction","iterations","percent","dy","per","floor","nowPercent","nowDirection","nowX","nowY","loaded","clearCache","p","domParent","addForceRefreshTask","emit","removeFrameAnimate","frameAnimate","__config","shadowRoot","texCache","render","renderMode","lv","ctx","cache","dx","computedStyle","sx","sy","globalAlpha","opacity","m","tfo","origin","r","deg","t","sin","cos","url","getInstance","sourceWidth","sourceHeight","drawImage","c","page","pos","__bbox","__sx","__sy","t2","pm","matrixEvent","setTransform","hookGlRender","gl","cx","cy","revertY","slice","addTexAndDrawWhenLimit","Array","isArray","random","round","inject","measureImg","res","success","hookData","__playbackRate","v","parseFloat","__interval","parseInt","__intervalNum","__num","Infinity","test","visibility","Component","version"],"mappings":"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"}